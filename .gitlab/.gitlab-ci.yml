image: quay.io/pypa/manylinux_2_28_x86_64

stages:
  - package

package:
  stage: package
  when: manual
  tags:
    - devsecops-instance
  script: |

    # build python wheel
    source "$CI_PROJECT_DIR/.gitlab/build_wheel.sh"

    # upload package
    python3.12 -m pip install -U twine
    TWINE_PASSWORD=${CI_JOB_TOKEN} \
      TWINE_USERNAME=gitlab-ci-token \
      python3.12 -m twine upload \
      --repository-url ${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/pypi \
      wheelhouse/*

  artifacts:
    paths:
      - wheelhouse/*.whl
